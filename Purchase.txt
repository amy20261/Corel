*** Settings ***
Resource           Global_Keyword/Keyword_001_Home.txt
Library            Selenium2Library
Resource           Global_Keyword/Keyword_000_Verification.txt
Resource           Global_Keyword/Keyword_002_Special_Offer_Page.txt
Resource           Global_Keyword/Keyword_003_Product.txt
Library            BuiltIn
Library            OperatingSystem
Library            String

*** Test Cases ***
Purchase flow_PTR
     ${microsite}     set variable     painterartist
     ${product}     set variable     painter
     ${env}     set variable     stg
     ${lang}     set variable     en
     ${currency}     set variable     en-GB
     ${version}     set variable     FULL
     ${serial }     set variable     PF18R22
     ${download}     set variable     CorelPainter2018.exe
     close all browsers
     Open Browser to Product Page_PURCHASE     ${env}     ${microsite}     ${lang}     ${currency}     ${product}
     Select purchase version     ${version}
     ${Price}     Get price from product page
     take screenshot on product page     ${microsite}     ${currency}     ${product}
     Click Buy Now
     verify price on cart page     ${Price}
     take screenshot on cart page     ${microsite}     ${currency}     ${product}
     Click Secure Checkout
     sleep     3
     input personal info
     Click Continue
     sleep     3
     input credit card info
     Click Checkout
     sleep     3
     verify price on review page     ${Price}
     take screenshot on review page     ${microsite}     ${currency}     ${product}
     Click Purchase
     sleep     3
     Verify serial num     ${serial }
     Verify Download link     ${download}
     take screenshot on checkout page     ${microsite}     ${currency}     ${product}
     close all browsers

Purchase flow_PSU/PSP/PSB
     ${microsite}     set variable     paintshoppro
     ${product}     set variable     paintshop-pro/ultimate
     ${env}     set variable     stg
     ${lang}     set variable     jp
     ${currency}     set variable     ja-JP
     ${version}     set variable     FULL
     ${serial }     set variable     PF18R22
     ${download}     set variable     psp9ak.exe
     close all browsers
     Open Browser to Products Page_PURCHASE     ${env}     ${microsite}     ${lang}     ${currency}     ${product}
     Select purchase version_PSP     ${version}
     ${Price}     Get price from product page_PSP
     take screenshot on product page     ${microsite}     ${currency}     ${product}
     #Click button_PSP
     verify price on cart page     ${Price}
     input personal info_PSP
     input credit card info
     take screenshot on cart page     ${microsite}     ${currency}     ${product}
     Click Checkout
     sleep     3
     verify price on review page_PSP     ${Price}
     take screenshot on review page     ${microsite}     ${currency}     ${product}
     Click Purchase
     sleep     3
     Verify serial num     ${serial }
     Verify Download link     ${download}
     take screenshot on checkout page     ${microsite}     ${currency}     ${product}
     close all browsers

*** Keywords ***
take screenshot on product page
     [Arguments]     ${microsite}     ${currency}     ${product}
     Remove file     c:\\log\\${microsite}\\${currency}_${product}_01product.jpg
     capture page screenshot     c:\\log\\${microsite}\\${currency}_${product}_01product.jpg

take screenshot on cart page
     [Arguments]     ${microsite}     ${currency}     ${product}
     run keyword and ignore error     Remove file     c:\\log\\${microsite}\\${currency}_${product}_02Cart.jpg
     capture page screenshot     c:\\log\\${microsite}\\${currency}_${product}_02Cart.jpg

input personal info
     input text     //input[@id='cbiID0ECAOBDBBOA']     Amy
     input text     //input[@id='cbiID0ECANBDBBOA']     Hsieh
     select from list by value     //select[@id='deliveryListenerStateId']     TW
     #sleep     3
     input text     //input[@id='cbiID0ECAKBDBBOA']     Sunlight
     input text     //input[@id='cbiID0ECAIBDBBOA']     114
     input text     //input[@id='cbiID0ECAHBDBBOA']     TPE
     input text     //input[@id='cbiID0EDAEBDBBOA']     0988050351
     input text     //input[@id='cbiID0ECABBBDBBOA']     amy.hsieh@corel.com
     input text     //input[@id='cbiID0ECAABBDBBOA']     amy.hsieh@corel.com

input credit card info
     input text     //input[@id='cbiID0ECABDAASDAHBOA']     T88747451022383T
     select from list by value     //select[@id='cbiID0ECABCCAASDAHBOA']     10
     select from list by value     //select[@id='cbiID0ECAACCAASDAHBOA']     2030
     input text     //input[@id='cbiID0ECABCAASDAHBOA']     123
     #input text     //input[@id='cbiID0ECABCAASDAHBOA']     Amy Hsieh

take screenshot on review page
     [Arguments]     ${microsite}     ${currency}     ${product}
     Remove file     c:\\log\\${microsite}\\${currency}_${product}_03review.jpg
     capture page screenshot     c:\\log\\${microsite}\\${currency}_${product}_03review.jpg

take screenshot on checkout page
     [Arguments]     ${microsite}     ${currency}     ${product}
     Remove file     c:\\log\\${microsite}\\${currency}_${product}_04checkout.jpg
     capture page screenshot     c:\\log\\${microsite}\\${currency}_${product}_04checkout.jpg

Select purchase version
     [Arguments]     ${version}
     select from list by label     //select[@id='top-version-select']     ${version}
     sleep     3

Get price from product page
     ${Price}=     Get text     //div[@class='price']/div[@style='display: inline;']/span[@class='priceDisplayNormal']
     [Return]     ${Price}

verify price on cart page
     [Arguments]     ${Price}
     sleep     3
     Reload Page
     run keyword and ignore error     element text should be     //span[@class="CBProductTotalPrice"]/span     ${Price}

verify price on review page
     [Arguments]     ${Price}
     run keyword and ignore error     element text should be     //span[@class='CBPrice price \ priceGross']     ${Price}

Verify serial num
     [Arguments]     ${serial }
     ${serial num}     get text     //span[@class='key']
     Should start with     ${serial num}     ${serial }     serial num failed

Verify Download link
     [Arguments]     ${download}
     ${Download}     Get element attribute     //a[@class="fulfilmentContentLink"]@href
     Should contain     ${Download}     ${download}     Downlaod failed

Click Buy Now
     click button     //button[@class="Button blueButton"]

Click Secure Checkout
     click button     //input[@name='buttondefaultCheckout']

Click Continue
     click button     //input[@name='buttondefaultNext']

Click Checkout
     #click button     //input[@name='buttonpaymentNext']
     click button     //input[@value='Next']

Click Purchase
     click button     //input[@name='buttonreviewSave']

Select purchase version_PSP
     [Arguments]     ${version}
     select from list by label     //select[@id='version-select']     ${version}
     sleep     3

Get price from product page_PSP
     ${Price}=     Get text     //div[@class='price']/div[@style='display: inline;']//span[@class='priceDisplayNormal']
     [Return]     ${Price}

Click button_PSP
     click button     //a[contains(.,'Full Version')]     #//div[@class='buttons']//a[@class='BuyLink btn btn-primary']

input personal info_PSP
     input text     //input[@id='cbiID0ECAOCDHBOA']     Amy
     input text     //input[@id='cbiID0ECANCDHBOA']     Hsieh
     select from list by value     //select[@id='deliveryListenerStateId']     TW
     #sleep     3
     input text     //input[@id='cbiID0ECAKCDHBOA']     Sunlight
     input text     //input[@id='cbiID0ECAICDHBOA']     114
     input text     //input[@id='cbiID0ECAHCDHBOA']     TPE
     #input text     //input[@id='cbiID0EDAEBDBBOA']     0988050351
     input text     //input[@id='cbiID0ECABBCDHBOA']     amy.hsieh@corel.com
     input text     //input[@id='ccbiID0ECAABCDHBOA']     amy.hsieh@corel.com

verify price on review pagePSP
     [Arguments]     ${Price}
     run keyword and ignore error     element text should be     //span[@class='CBPrice price unitPriceGross']     ${Price}
